
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>APOS-HC 調査票 - フォーム3</title>
  <link rel="stylesheet" href="main.css">
  <style>
    /* セクション表示の修正 */
    .section { 
      display: block !important; 
    }
    
    /* iPad用の追加スタイル */
    @media screen and (min-width: 768px) {
      body {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        font-size: 16px;
        line-height: 1.5;
      }
      
      .container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        padding: 25px;
        margin: 15px 0;
      }
      
      h1 {
        font-size: 1.8em;
        color: #2c3e50;
        text-align: center;
        margin-bottom: 25px;
        border-bottom: 2px solid #3498db;
        padding-bottom: 15px;
      }
      
      h2 {
        font-size: 1.4em;
        color: #34495e;
        margin: 25px 0 15px 0;
        padding: 10px 0;
        border-left: 4px solid #3498db;
        padding-left: 15px;
        background: linear-gradient(90deg, #f8f9fa 0%, transparent 100%);
      }
      
      fieldset {
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background: #fafbfc;
        transition: all 0.3s ease;
      }
      
      fieldset:hover {
        border-color: #3498db;
        box-shadow: 0 2px 10px rgba(52, 152, 219, 0.1);
      }
      
      legend {
        font-size: 1.1em;
        font-weight: bold;
        color: #2c3e50;
        padding: 0 10px;
        background: #fff;
        border-radius: 6px;
        border: 2px solid #3498db;
      }
      
      label {
        display: block;
        margin: 10px 0 5px 0;
        font-weight: 600;
        color: #34495e;
        font-size: 1em;
      }
      
      input[type="text"], input[type="tel"], input[type="email"], 
      input[type="number"], select, textarea {
        width: 100%;
        padding: 10px 12px;
        font-size: 1em;
        border: 2px solid #e0e6ed;
        border-radius: 6px;
        background: #fff;
        transition: all 0.3s ease;
        box-sizing: border-box;
        margin-top: 5px;
      }
      
      input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        transform: translateY(-2px);
      }
      
      textarea {
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
      }
      
      .daily-rhythm-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      }
      
      .daily-rhythm-table th {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 12px 10px;
        font-size: 1em;
        font-weight: bold;
        text-align: center;
      }
      
      .daily-rhythm-table td {
        padding: 10px;
        border-bottom: 1px solid #e8f4f8;
        text-align: center;
        vertical-align: middle;
      }
      
      .daily-rhythm-table td:first-child {
        background: #f8f9fa;
        font-weight: 600;
        color: #2c3e50;
        font-size: 0.9em;
        width: 150px;
      }
      
      .daily-rhythm-table input {
        width: 100%;
        padding: 8px 10px;
        font-size: 0.9em;
        border: 2px solid #e0e6ed;
        border-radius: 6px;
        background: #fff;
        transition: all 0.3s ease;
        margin: 0;
      }
      
      .daily-rhythm-table input:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }
      
      .daily-rhythm-table tr:hover {
        background: #f8f9fa;
      }
      
      .note {
        font-size: 0.9em;
        color: #7f8c8d;
        margin-top: 10px;
        padding: 10px;
        background: #ecf0f1;
        border-radius: 6px;
        border-left: 3px solid #95a5a6;
      }
      
      .nav-buttons {
        margin-top: 25px;
        display: flex;
        justify-content: space-between;
        gap: 15px;
      }
      
      .nav-buttons button {
        padding: 12px 25px;
        font-size: 1em;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
      }
      
      .nav-buttons button:first-child {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        color: white;
      }
      
      .nav-buttons button:last-child {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }
      
      .nav-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      }
      
      .nav-buttons button:active {
        transform: translateY(-1px);
      }
      
      /* プログレスバーのスタイル */
      .progress-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #fff;
        border-top: 1px solid #e0e0e0;
        padding: 20px;
        z-index: 1000;
      }
      
      .progress-wrapper {
        max-width: 800px;
        margin: 0 auto;
      }
      
      .progress-bar {
        width: 100%;
        height: 6px;
        background: #f0f0f0;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 15px;
      }
      
      .progress-fill {
        height: 100%;
        background: #003366;
        border-radius: 3px;
        transition: width 0.5s ease;
        width: 75%;
      }
      
      .progress-info {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.1em;
        color: #333;
        font-weight: 500;
      }
      
      .progress-page {
        color: #003366;
        font-weight: 600;
      }
      
      .progress-total {
        color: #999;
      }
      
      /* フォームの下部に余白を追加（プログレスバーの分） */
      body {
        padding-bottom: 100px;
      }
    }
    
    /* タブレット用の追加調整 */
    @media screen and (max-width: 1024px) and (min-width: 768px) {
      .daily-rhythm-table td:first-child {
        width: 140px;
      }
      
      .daily-rhythm-table input {
        font-size: 0.85em;
        padding: 6px 8px;
      }
    }
  </style>
  <script src="survey-common.js"></script>
</head>
<body>

<div class="container">
<h1>APOS-HC 調査票</h1>
<form id="surveyForm">
<div class="section" id="section-disease-categories">
  <h2>Ⅰ　主な疾患・障害の有無</h2>
  <fieldset>
    <legend>以下の疾患・障害について該当するものを選択し、詳細がある場合はご記入ください</legend>
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="border:1px solid #b0d6e6;">No</th>
          <th style="border:1px solid #b0d6e6;">疾患区分</th>
          <th style="border:1px solid #b0d6e6;">あり／なし・詳細・補足</th>
        </tr>
      </thead>
      <tbody>
        <!-- 1. 高齢による衰弱 -->
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">1</td>
          <td style="border:1px solid #b0d6e6;">高齢による衰弱</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="frailty_exist" id="frailty_exist">
              <option value="">選択</option>
              <option value="あり">あり</option>
              <option value="なし">なし</option>
            </select>
            <div id="frailty_detail" style="display:none; margin-top:0.5em;">
              <label><input type="checkbox" name="frailty_detail[]" value="1"> ①特に疾患がなく老いて体の機能が衰弱</label><br>
              <label><input type="checkbox" name="frailty_detail[]" value="2"> ②便秘</label><br>
              <label><input type="checkbox" name="frailty_detail[]" value="3"> ③食欲低下</label><br>
              <label><input type="checkbox" name="frailty_detail[]" value="4"> ④フレイル</label><br>
              <label><input type="checkbox" name="frailty_detail[]" value="99" id="frailty_detail_other_chk"> ⑤その他病名</label>
              <input type="text" name="frailty_other" id="frailty_other" style="width:98%; margin-top:0.5em; display:none;" placeholder="その他の病名・補足（自由入力）">
            </div>
            <script>
              document.getElementById('frailty_exist').addEventListener('change', function() {
                var detailDiv = document.getElementById('frailty_detail');
                if (this.value === 'あり') {
                  detailDiv.style.display = 'block';
                } else {
                  detailDiv.style.display = 'none';
                }
              });

              // その他病名チェックでテキスト表示
              var otherChk = document.getElementById('frailty_detail_other_chk');
              var otherInput = document.getElementById('frailty_other');
              if (otherChk && otherInput) {
                otherChk.addEventListener('change', function() {
                  if (this.checked) {
                    otherInput.style.display = 'inline-block';
                  } else {
                    otherInput.style.display = 'none';
                  }
                });
              }
            </script>
        <!-- 2. 認知症 -->
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">2</td>
          <td style="border:1px solid #b0d6e6;">認知症</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="dementia_exist" id="dementia_exist">
              <option value="">選択</option>
              <option value="あり">あり</option>
              <option value="なし">なし</option>
            </select>
            <div id="dementia_detail" style="display:none; margin-top:0.5em;">
              <label><input type="checkbox" name="dementia_detail[]" value="1"> ①アルツハイマー</label><br>
              <label><input type="checkbox" name="dementia_detail[]" value="2"> ②血管型</label><br>
              <label><input type="checkbox" name="dementia_detail[]" value="3"> ③レビー小体型</label><br>
              <label><input type="checkbox" name="dementia_detail[]" value="4"> ④軽度認知障害</label><br>
              <label><input type="checkbox" name="dementia_detail[]" value="99" id="dementia_detail_other_chk"> ⑤その他の病名</label>
              <input type="text" name="dementia_other" id="dementia_other" style="width:98%; margin-top:0.5em; display:none;" placeholder="その他の病名・補足（自由入力）">
        </tr>
        <!-- 3. 悪性新生物 -->
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">3</td>
          <td style="border:1px solid #b0d6e6;">悪性新生物</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="cancer_exist" id="cancer_exist">
              <option value="">選択</option>
              <option value="あり">あり</option>
              <option value="なし">なし</option>
            </select>
            <div id="cancer_detail" style="display:none; margin-top:0.5em;">
              <label><input type="checkbox" name="cancer_detail[]" value="1"> ①大腸</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="2"> ②胃</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="3"> ③気管・気管支・肺</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="4"> ④乳房</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="5"> ⑤前立腺</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="6"> ⑥子宮</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="7"> ⑦肝</label><br>
              <label><input type="checkbox" name="cancer_detail[]" value="99" id="cancer_detail_other_chk"> ⑧その他の病名</label>
              <input type="text" name="cancer_other" id="cancer_other" style="width:98%; margin-top:0.5em; display:none;" placeholder="その他の病名・補足（自由入力）">
            </div>
          </td>
        </tr>
        <!-- 4. 脳血管・循環器疾患 -->
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">4</td>
          <td style="border:1px solid #b0d6e6;">脳血管・循環器疾患</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="circulatory_exist" id="circulatory_exist">
              <option value="">選択</option>
              <option value="あり">あり</option>
              <option value="なし">なし</option>
            </select>
            <div id="circulatory_freewrite" style="display:none; margin-top:0.5em;">
              <input type="text" name="circulatory_freewrite_input" id="circulatory_freewrite_input" style="width:98%;" placeholder="ありの場合：詳細や補足事項をご記入ください（自由入力）">
            </div>
            <script>
              // ありを選択時に自由記述欄を表示
              document.addEventListener('DOMContentLoaded', function() {
                var select = document.getElementById('circulatory_exist');
                var freewriteDiv = document.getElementById('circulatory_freewrite');
                if (select && freewriteDiv) {
                  select.addEventListener('change', function() {
                    if (select.value === 'あり') {
                      freewriteDiv.style.display = 'block';
                    } else {
                      freewriteDiv.style.display = 'none';
                      var fwInput = document.getElementById('circulatory_freewrite_input');
                      if (fwInput) fwInput.value = '';
                    }
                  });
                }
              });
            </script>
        </tr>
        <!-- 5. 骨折・関節疾患 -->
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">5</td>
          <td style="border:1px solid #b0d6e6;">骨折・転倒・関節疾患、足・足趾・爪・下肢の循環等の状態</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="bone_exist" id="bone_exist">
              <option value="">選択</option>
              <option value="あり">あり</option>
              <option value="なし">なし</option>
            </select>
            <div id="bone_detail" style="display:none; margin-top:0.5em;">
              <label><input type="checkbox" name="bone_detail[]" value="1"> ①脊椎障害</label><br>
              <label><input type="checkbox" name="bone_detail[]" value="2"> ②関節リュウマチ</label><br>
              <label><input type="checkbox" name="bone_detail[]" value="3"> ③関節症・関節炎</label><br>
              <label><input type="checkbox" name="bone_detail[]" value="4"> ④腰痛・坐骨神経痛</label><br>
              <label><input type="checkbox" name="bone_detail[]" value="5"> ⑤骨折・転倒</label><br>
              <label><input type="checkbox" name="bone_detail[]" value="5"> ⑥足の巻き爪・爪肥厚・爪白癬等</label><br>
              <label><input type="checkbox" name="bone_detail[]" value="99" id="bone_detail_other_chk"> ⑥その他病名</label>
              <input type="text" name="bone_other" id="bone_other" style="width:98%; margin-top:0.5em; display:none;" placeholder="その他の病名・補足（自由入力）">
              <script>
                // 「その他病名」チェックボックスでテキスト入力欄を表示/非表示
                document.addEventListener('DOMContentLoaded', function() {
                  var otherChk = document.getElementById('bone_detail_other_chk');
                  var otherInput = document.getElementById('bone_other');
                  if (otherChk && otherInput) {
                    otherChk.addEventListener('change', function() {
                      if (otherChk.checked) {
                        otherInput.style.display = 'block';
                      } else {
                        otherInput.style.display = 'none';
                        otherInput.value = '';
                      }
                    });
                  }
                });
              </script>
            </div>
          </td>
        </tr>
        <!-- 6. 下肢の循環障害 -->
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">6</td>
          <td style="border:1px solid #b0d6e6;">その他の疾患</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="leg_circulation_exist" id="leg_circulation_exist">
              <option value="">選択</option>
              <option value="あり">あり</option>
              <option value="なし">なし</option>
            </select>
            <div id="leg_circulation_detail" style="display:none; margin-top:0.5em;">
              <input type="text" name="leg_circulation_other" id="leg_circulation_other" style="width:98%; margin-top:0.5em; display:none;" placeholder="その他の病名・補足（自由入力）">
            </div>
            <div id="leg_circulation_freewrite" style="display:none; margin-top:0.5em;">
              <input type="text" name="leg_circulation_freewrite_input" id="leg_circulation_freewrite_input" style="width:98%;" placeholder="ありの場合：詳細や補足事項をご記入ください（自由入力）">
            </div>
            <script>
              // ありを選択時に自由記述欄を表示
              document.addEventListener('DOMContentLoaded', function() {
                var select = document.getElementById('leg_circulation_exist');
                var freewriteDiv = document.getElementById('leg_circulation_freewrite');
                if (select && freewriteDiv) {
                  select.addEventListener('change', function() {
                    if (select.value === 'あり') {
                      freewriteDiv.style.display = 'block';
                    } else {
                      freewriteDiv.style.display = 'none';
                      var fwInput = document.getElementById('leg_circulation_freewrite_input');
                      if (fwInput) fwInput.value = '';
                    }
                  });
                }
              });
            </script>
          </td>
        </tr>
      </tbody>
    </table>
  </fieldset>
  <script>
    // ありを選択したときに詳細を表示、なし/未選択で非表示
    function handleDiseaseDetail(selectId, detailDivId) {
      var select = document.getElementById(selectId);
      var detailDiv = document.getElementById(detailDivId);
      if (!select || !detailDiv) {
        return;
      }
      select.addEventListener('change', function() {
        if (select.value === 'あり') {
          detailDiv.style.display = 'block';
        } else {
          detailDiv.style.display = 'none';
          // 詳細selectの値をリセット
          var detailSelect = detailDiv.querySelector('select');
          if (detailSelect) detailSelect.value = '';
          // その他入力欄も非表示・リセット
          var otherInput = detailDiv.querySelector('input[type="text"]');
          if (otherInput) {
            otherInput.style.display = 'none';
            otherInput.value = '';
          }
        }
      });
    }
    // その他病名選択時にテキストボックス表示
    function handleOtherDetail(detailSelectId, otherInputId) {
      var detailSelect = document.getElementById(detailSelectId);
      var otherInput = document.getElementById(otherInputId);
      if (!detailSelect || !otherInput) return;
      detailSelect.addEventListener('change', function() {
        if (detailSelect.value === '99') {
          otherInput.style.display = 'block';
        } else {
          otherInput.style.display = 'none';
          otherInput.value = '';
        }
      });
    }
    document.addEventListener('DOMContentLoaded', function() {
      handleDiseaseDetail('frailty_exist', 'frailty_detail');
      handleDiseaseDetail('dementia_exist', 'dementia_detail');
      handleDiseaseDetail('cancer_exist', 'cancer_detail');
      handleDiseaseDetail('circulatory_exist', 'circulatory_detail');
      handleDiseaseDetail('bone_exist', 'bone_detail');
      handleDiseaseDetail('leg_circulation_exist', 'leg_circulation_detail');
      handleOtherDetail('frailty_detail_select', 'frailty_other');
      handleOtherDetail('dementia_detail_select', 'dementia_other');
      handleOtherDetail('cancer_detail_select', 'cancer_other');
      handleOtherDetail('circulatory_detail_select', 'circulatory_other');
      handleOtherDetail('bone_detail_select', 'bone_other');
      handleOtherDetail('leg_circulation_detail_select', 'leg_circulation_other');
    });
  </script>
</div>


  
<div class="section" id="section-lifestyle-habits">
  <fieldset>
    <legend>2. 主治医の診断名・治療方針・生活指導の状況</legend>
    <div style="overflow-x:auto;">
      <table style="width:100%; border-collapse:collapse; margin-bottom:12px; background:#f8f9fa;">
           <!-- 主治医の診断名・治療方針・生活指導の状況の記述欄 -->
      <div style="margin-top: 12px; margin-bottom: 8px;">
        <label for="doctor_diagnosis_note" style="font-weight:bold;">主治医の診断名・治療方針・生活指導の状況（自由記述）</label>
        <textarea id="doctor_diagnosis_note" name="doctor_diagnosis_note" rows="4" style="width:98%; font-size:1em;" placeholder="主治医の診断名、治療方針、生活指導の状況についてご記入ください"></textarea>
      </div>
       
        <thead>
          <tr>
       
            <th style="width:18%; border:1px solid #b0d6e6; text-align:center; font-size:0.98em; padding:6px 2px;">
              他診療所・病院
            </th>
            <th style="width:18%; border:1px solid #b0d6e6; text-align:center; font-size:0.98em; padding:6px 2px;">
              診断名
            </th>
            <th style="width:18%; border:1px solid #b0d6e6; text-align:center; font-size:0.98em; padding:6px 2px;">
              内　容
            </th>
            <th style="width:18%; border:1px solid #b0d6e6; text-align:center; font-size:0.98em; padding:6px 2px;">
              備　考
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
         
            
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="other_hospital_1" style="width:96%;" placeholder="病院・診療所名">
            </td>
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="diagnosis_1" style="width:96%;" placeholder="診断名">
            </td>
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="treatment_content_1" style="width:96%;" placeholder="治療・指導内容">
            </td>
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="remarks_1" style="width:96%;" placeholder="備考">
            </td>
          </tr>
          <tr>
          
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="other_hospital_2" style="width:96%;">
            </td>
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="diagnosis_2" style="width:96%;">
            </td>
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="treatment_content_2" style="width:96%;">
            </td>
            <td style="border:1px solid #b0d6e6; padding:4px;">
              <input type="text" name="remarks_2" style="width:96%;">
            </td>
          </tr>
          <tr>
   
        
        
  
      </table>
    </fieldset>
  </div>
   
<div class="section" id="section-lifestyle-habits">
    <fieldset>
      <legend>３ 受診行動</legend>
      <div style="overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse; margin-bottom:12px; background:#f8f9fa;">
    <tr>
      <td colspan="4" style="text-align:left; padding:8px 4px;">
        <label for="yes_no_select">定期に通院中又は往診(訪問診療)を利用し,セルフコントロールができていますか？</label>
        <select id="yes_no_select" name="yes_no_select" style="margin-left:12px;">
          <option value="">選択してください</option>
          <option value="yes">はい</option>
          <option value="no">いいえ</option>
        </select>
        <div id="no_detail_options" style="display:none; margin-top:8px;">
          <label style="font-weight:bold;">※「いいえ」を選んだ場合、該当するものを選択してください（複数選択可）</label>
          <div style="margin-top:4px;">
            <label><input type="checkbox" name="no_reason[]" value="a"> a. 通院が必要だが、定期に受診しないことがある。予約できない</label><br>
            <label><input type="checkbox" name="no_reason[]" value="b"> b. 通院中だが1人で通院できない、付き添えは必要できる</label><br>
            <label><input type="checkbox" name="no_reason[]" value="c"> c. 治療の必要があるが、症状が軽く付き添っても通院できる状態にしたい</label><br>
            <label><input type="checkbox" name="no_reason[]" value="d"> d. 治療や通院は不要と思い受診を拒否する</label><br>
            <label><input type="checkbox" name="no_reason[]" value="e"> e. 同じ症状で複数の医療機関に受診している、処方内容が一致しない</label><br>
            <label><input type="checkbox" name="no_reason[]" value="f"> f. 併存疾患・通院可否意見が不十分・治療/指導が不十分</label>
          </div>
        </div>
        <script>
          document.getElementById('yes_no_select').addEventListener('change', function() {
            var noDetail = document.getElementById('no_detail_options');
            if (this.value === 'no') {
              noDetail.style.display = 'block';
            } else {
              noDetail.style.display = 'none';
            }
          });
        </script>
   </table>
</fieldset>
</div>

<div class="section" id="section-disease-categories">
  <h2>Ⅱ　医療処置・ケア</h2>
  <fieldset>
    <legend>医療処置/リハ機器・補助具</legend>
    <table style="width:100%; border-collapse:collapse;">
      <tbody>
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">1</td>
          <td style="border:1px solid #b0d6e6;">栄養</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="nutrition_exist" id="nutrition_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="nutrition_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;"><input type="checkbox" name="nutrition_type" value="central_venous" style="margin-left:1.5em;"> ①中心静脈栄養</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="nutrition_type" value="nasogastric" style="margin-left:1.5em;"> ②経鼻経管栄養</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="nutrition_type" value="peg" style="margin-left:1.5em;"> ③PEG(胃ろう・腸ろう)</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var nutritionExist = document.getElementById("nutrition_exist");
                var nutritionTypeDiv = document.getElementById("nutrition_type_checkboxes");
                function checkNutritionOption() {
                  if (nutritionExist.value === "1") {
                    nutritionTypeDiv.style.display = "";
                  } else {
                    nutritionTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(nutritionTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                nutritionExist.addEventListener("change", checkNutritionOption);
                checkNutritionOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">2</td>
          <td style="border:1px solid #b0d6e6;">注射</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="injection_exist" id="injection_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="injection_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;"><input type="checkbox" name="injection_type" value="subcutaneous_infusion" style="margin-left:1.5em;"> ①皮下輸液</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="injection_type" value="blood_transfusion" style="margin-left:1.5em;"> ②輸血</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="injection_type" value="insulin_self_injection" style="margin-left:1.5em;"> ③インシュリン・自己注射</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="injection_type" value="intravenous_injection" style="margin-left:1.5em;"> ④静脈内注射</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="injection_type" value="drip_infusion" style="margin-left:1.5em;"> ⓹点滴</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var injectionExist = document.getElementById("injection_exist");
                var injectionTypeDiv = document.getElementById("injection_type_checkboxes");
                function checkInjectionOption() {
                  if (injectionExist.value === "1") {
                    injectionTypeDiv.style.display = "";
                  } else {
                    injectionTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(injectionTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                injectionExist.addEventListener("change", checkInjectionOption);
                checkInjectionOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">3</td>
          <td style="border:1px solid #b0d6e6;">カテーテル</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="catheter_exist" id="catheter_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="catheter_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;"><input type="checkbox" name="catheter_type" value="indwelling_bladder_catheter" style="margin-left:1.5em;"> ①膀胱留置カテーテル</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="catheter_type" value="condom_catheter" style="margin-left:1.5em;"> ②コンドームカテーテル</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="catheter_type" value="self_catheterization" style="margin-left:1.5em;"> ③導尿・自己導尿</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var catheterExist = document.getElementById("catheter_exist");
                var catheterTypeDiv = document.getElementById("catheter_type_checkboxes");
                function checkCatheterOption() {
                  if (catheterExist.value === "1") {
                    catheterTypeDiv.style.display = "";
                  } else {
                    catheterTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(catheterTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                catheterExist.addEventListener("change", checkCatheterOption);
                checkCatheterOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>
      <td style="border:1px solid #b0d6e6; text-align:center;">4</td>
      <td style="border:1px solid #b0d6e6;">気管切開</td>
      <td style="border:1px solid #b0d6e6;">
        <select name="tracheotomy_exist" id="tracheotomy_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="tracheotomy_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;"><input type="checkbox" name="tracheotomy_type" value="suction" style="margin-left:1.5em;"> ①吸引</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="tracheotomy_type" value="inhalation" style="margin-left:1.5em;"> ②吸入</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="tracheotomy_type" value="home_oxygen" style="margin-left:1.5em;"> ③在宅酸素</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="tracheotomy_type" value="ventilator" style="margin-left:1.5em;"> ④人工呼吸器（マスク型/気管切開型）</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var tracheotomyExist = document.getElementById("tracheotomy_exist");
                var tracheotomyTypeDiv = document.getElementById("tracheotomy_type_checkboxes");
                function checkTracheotomyOption() {
                  if (tracheotomyExist.value === "1") {
                    tracheotomyTypeDiv.style.display = "";
                  } else {
                    tracheotomyTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(tracheotomyTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                tracheotomyExist.addEventListener("change", checkTracheotomyOption);
                checkTracheotomyOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">5</td>
          <td style="border:1px solid #b0d6e6;">呼吸</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="respiration_exist" id="respiration_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="respiration_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;"><input type="checkbox" name="respiration_type" value="suction" style="margin-left:1.5em;"> ①吸引</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="respiration_type" value="inhalation" style="margin-left:1.5em;"> ②吸入</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="respiration_type" value="home_oxygen" style="margin-left:1.5em;"> ③在宅酸素</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="respiration_type" value="ventilator" style="margin-left:1.5em;"> ④人工呼吸器（マスク型/気管切開型）</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var respirationExist = document.getElementById("respiration_exist");
                var respirationTypeDiv = document.getElementById("respiration_type_checkboxes");
                function checkRespirationOption() {
                  if (respirationExist.value === "1") {
                    respirationTypeDiv.style.display = "";
                  } else {
                    respirationTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(respirationTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                respirationExist.addEventListener("change", checkRespirationOption);
                checkRespirationOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">6</td>
          <td style="border:1px solid #b0d6e6;">透析</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="dialysis_exist" id="dialysis_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="dialysis_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;"><input type="checkbox" name="dialysis_type" value="capd_apd" style="margin-left:1.5em;"> ①腹膜透析（CAPD：連続携行式　APD：自動腹膜透析）</label>
                <label style="vertical-align: middle;"><input type="checkbox" name="dialysis_type" value="hemodialysis" style="margin-left:1.5em;"> ②血液透析</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var dialysisExist = document.getElementById("dialysis_exist");
                var dialysisTypeDiv = document.getElementById("dialysis_type_checkboxes");
                function checkDialysisOption() {
                  if (dialysisExist.value === "1") {
                    dialysisTypeDiv.style.display = "";
                  } else {
                    dialysisTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(dialysisTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                dialysisExist.addEventListener("change", checkDialysisOption);
                checkDialysisOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">7</td>
          <td style="border:1px solid #b0d6e6;">ストーマ</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="stoma_exist" id="stoma_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="stoma_type_checkboxes" style="display:none; margin-top:0.5em;">
                <label><input type="checkbox" name="stoma_type" value="artificial_bladder" style="margin-left:1.5em;"> ①人工肛門</label>
                <label><input type="checkbox" name="stoma_type" value="artificial_bladder" style="margin-left:1.5em;"> ②人工膀胱</label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var stomaExist = document.getElementById("stoma_exist");
                var stomaTypeDiv = document.getElementById("stoma_type_checkboxes");
                function checkStomaOption() {
                  if (stomaExist.value === "1") {
                    stomaTypeDiv.style.display = "";
                  } else {
                    stomaTypeDiv.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(stomaTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                stomaExist.addEventListener("change", checkStomaOption);
                checkStomaOption();
              });
              </script>
          </td>
        </tr>
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">8</td>
              <td style="border:1px solid #b0d6e6;">創傷処置</td>
              <td style="border:1px solid #b0d6e6;">
                <select name="wound_exist" id="wound_exist">
                  <option value="">選択</option>
                  <option value="0">0. なし</option>
                  <option value="1">1. あり</option>
                  </select>
                  <div id="wound_type_checkboxes" style="display:none; margin-top:0.5em;">
                    <label style="vertical-align: middle;"><input type="checkbox" name="wound_type" value="artificial_bladder" style="margin-left:1.5em;"> ①褥瘡</label>
                    <label style="vertical-align: middle;"><input type="checkbox" name="wound_type" value="artificial_bladder" style="margin-left:1.5em;"> ②創傷</label>
                  </div>
                  <script>
                  document.addEventListener("DOMContentLoaded", function() {
                    var woundExist = document.getElementById("wound_exist");
                    var woundTypeDiv = document.getElementById("wound_type_checkboxes");
                    function checkWoundOption() {
                      if (woundExist.value === "1") {
                        woundTypeDiv.style.display = "";
                      } else {
                        woundTypeDiv.style.display = "none";
                        // Uncheck checkboxes when hidden
                        Array.from(woundTypeDiv.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                      }
                    }
                    woundExist.addEventListener("change", checkWoundOption);
                    checkWoundOption();
                  });
                  </script>
             
          </td>
        </tr>
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">9</td>
              <td style="border:1px solid #b0d6e6;">疼痛管理</td>
              <td style="border:1px solid #b0d6e6;">
                <select name="pain_management_exist" id="pain_management_exist">
                  <option value="">選択</option>
                  <option value="0">0. なし</option>
                  <option value="1">1. あり</option>
                  </select>
                  <div id="pain_management_options" style="display:none; margin-top:0.5em;">
                    <label style="vertical-align: middle;"><input type="checkbox" name="pain_management" value="subcutaneous_injection" style="margin-left:1.5em;"> ①持続皮下注射</label>
                    <label style="vertical-align: middle;"><input type="checkbox" name="pain_management" value="epidural_injection" style="margin-left:1.5em;"> ②硬膜外注射</label>
                    <label style="vertical-align: middle;"><input type="checkbox" name="pain_management" value="oral_medication" style="margin-left:1.5em;"> ③服薬</label>
                    <label style="vertical-align: middle;"><input type="checkbox" name="pain_management" value="patch_or_mucosal" style="margin-left:1.5em;"> ➃貼付剤/口腔粘膜吸収剤</label>
                    <label style="vertical-align: middle; margin-left:1.5em;">⑤麻薬（
                      <select name="narcotic_use" style="font-size:1em; margin:0 0.3em;">
                        <option value="">選択</option>
                        <option value="yes">有</option>
                        <option value="no">無</option>
                      </select>
                      ）
                    </label>
                  </div>
                  <script>
                  document.addEventListener("DOMContentLoaded", function() {
                    var painManagementExist = document.getElementById("pain_management_exist");
                    var painManagementOptions = document.getElementById("pain_management_options");
                    function checkPainManagementOption() {
                      if (painManagementExist.value === "1") {
                        painManagementOptions.style.display = "";
                      } else {
                        painManagementOptions.style.display = "none";
                        // Uncheck checkboxes when hidden
                        Array.from(painManagementOptions.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                      }
                    }
                    painManagementExist.addEventListener("change", checkPainManagementOption);
                    checkPainManagementOption();
                  });
                  </script>
             
          </td>
        </tr>
        <tr>
          <td style="border:1px solid #b0d6e6; text-align:center;">10</td>
              <td style="border:1px solid #b0d6e6;">自己測定</td>
              <td style="border:1px solid #b0d6e6;">
                <select name="self_measurement_exist" id="self_measurement_exist">
                  <option value="">選択</option>
                  <option value="0">0. なし</option>
                  <option value="1">1. あり</option>
                  </select>
                  <div id="self_measurement_options" style="display:none; margin-top:0.5em;">
                    <label style="vertical-align: middle;">
                      <input type="checkbox" name="self_measurement" value="blood_glucose" style="margin-left:1.5em;"> ①血糖自己測定
                    </label>
                    <label style="vertical-align: middle;">
                      <input type="checkbox" name="self_measurement" value="continuous_monitor" style="margin-left:1.5em;"> ②持続モニター測定(心拍・血圧・酸素飽和度)
                    </label>
                  </div>
                  <script>
                  document.addEventListener("DOMContentLoaded", function() {
                    var selfMeasurementExist = document.getElementById("self_measurement_exist");
                    var selfMeasurementOptions = document.getElementById("self_measurement_options");
                    function checkSelfMeasurementOption() {
                      if (selfMeasurementExist.value === "1") {
                        selfMeasurementOptions.style.display = "";
                      } else {
                        selfMeasurementOptions.style.display = "none";
                        // Uncheck checkboxes when hidden
                        Array.from(selfMeasurementOptions.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                      }
                    }
                    selfMeasurementExist.addEventListener("change", checkSelfMeasurementOption);
                    checkSelfMeasurementOption();
                  });
                  </script>
             
          </td>
        </tr>
        <tr>   
          <td style="border:1px solid #b0d6e6; text-align:center;">11</td>
          <td style="border:1px solid #b0d6e6;">口腔･う歯･歯肉</td>
          <td style="border:1px solid #b0d6e6;">
            <select name="oral_care_exist" id="oral_care_exist">
              <option value="">選択</option>
              <option value="0">0. なし</option>
              <option value="1">1. あり</option>
              </select>
              <div id="oral_care_options" style="display:none; margin-top:0.5em;">
                <label style="vertical-align: middle;">
                  <input type="checkbox" name="oral_visit" value="clinic" style="margin-left:1.5em;"> ①通院
                </label>
                <label style="vertical-align: middle;">
                  <input type="checkbox" name="oral_visit" value="home_visit" style="margin-left:1.5em;"> ②往診
                </label>
                <label style="vertical-align: middle;">
                  <input type="checkbox" name="oral_visit" value="dental_hygienist_visit" style="margin-left:1.5em;"> ③訪問歯科衛生
                </label>
              </div>
              <script>
              document.addEventListener("DOMContentLoaded", function() {
                var oralCareExist = document.getElementById("oral_care_exist");
                var oralCareOptions = document.getElementById("oral_care_options");
                function checkOralCareOption() {
                  if (oralCareExist.value === "1") {
                    oralCareOptions.style.display = "";
                  } else {
                    oralCareOptions.style.display = "none";
                    // Uncheck checkboxes when hidden
                    Array.from(oralCareOptions.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
                  }
                }
                oralCareExist.addEventListener("change", checkOralCareOption);
                checkOralCareOption();
              });
              </script>
         
      </td>
    </tr>
    <tr>    
      <td style="border:1px solid #b0d6e6; text-align:center;">12</td>
      <td style="border:1px solid #b0d6e6;">薬剤管理</td>
      <td style="border:1px solid #b0d6e6;">
        <select name="drug_management_exist" id="drug_management_exist">
          <option value="">選択</option>
          <option value="0">0. なし</option>
          <option value="1">1. あり</option>
          </select>
          <div id="drug_management_options" style="display:none; margin-top:0.5em;">
            <label style="vertical-align: middle;">
              <input type="checkbox" name="drug_management" value="oral_medication" style="margin-left:1.5em;"> ①内服薬
            </label>
            <label style="vertical-align: middle;">
              <input type="checkbox" name="drug_management" value="suppository" style="margin-left:1.5em;"> ②座薬
            </label>
            <label style="vertical-align: middle;">
              <input type="checkbox" name="drug_management" value="eye_drops" style="margin-left:1.5em;"> ③点眼薬
            </label>
            <label style="vertical-align: middle;">
              <input type="checkbox" name="drug_management" value="external_medicine" style="margin-left:1.5em;"> ④外用薬(貼り薬)
            </label>
            <label style="vertical-align: middle;">
              <input type="checkbox" name="drug_management" value="injection" style="margin-left:1.5em;"> ⑤注射･輸液･輸血･透析等
            </label>
          </div>
          <script>
          document.addEventListener("DOMContentLoaded", function() {
            var drugManagementExist = document.getElementById("drug_management_exist");
            var drugManagementOptions = document.getElementById("drug_management_options");
            function checkDrugManagementOption() {
              if (drugManagementExist.value === "1") {
                drugManagementOptions.style.display = "";
              } else {
                drugManagementOptions.style.display = "none";
                // Uncheck checkboxes when hidden
                Array.from(drugManagementOptions.querySelectorAll('input[type="checkbox"]')).forEach(c => c.checked = false);
              }
            }
            drugManagementExist.addEventListener("change", checkDrugManagementOption);
            checkDrugManagementOption();
          });
          </script>
     
  </td>
</tr>
<tr>    
  <td style="border:1px solid #b0d6e6; text-align:center;">13</td>
  <td style="border:1px solid #b0d6e6;">リハビリ機器使用</td>
  <td style="border:1px solid #b0d6e6;">
    <select name="rehab_equipment_exist" id="rehab_equipment_exist">
      <option value="">選択</option>
      <option value="0">0. なし</option>
      <option value="1">1. あり</option>
      </select>
      <div id="rehab_equipment_description_area" style="display:none; margin-top:0.5em;">
        <label for="rehab_equipment_description" style="vertical-align:middle; margin-left:1.5em;">内容を記述してください：</label>
        <textarea name="rehab_equipment_description" id="rehab_equipment_description" rows="2" style="width:85%; font-size:1em;"></textarea>
      </div>
      <script>
      document.addEventListener("DOMContentLoaded", function() {
        var rehabEquipmentExist = document.getElementById("rehab_equipment_exist");
        var rehabEquipmentDescriptionDiv = document.getElementById("rehab_equipment_description_area");
        function checkRehabEquipmentOption() {
          if (rehabEquipmentExist.value === "1") {
            rehabEquipmentDescriptionDiv.style.display = "";
          } else {
            rehabEquipmentDescriptionDiv.style.display = "none";
            var textarea = rehabEquipmentDescriptionDiv.querySelector('textarea');
            if (textarea) textarea.value = '';
          }
        }
        rehabEquipmentExist.addEventListener("change", checkRehabEquipmentOption);
        checkRehabEquipmentOption();
      });
      </script>
 
</td>
</tr>
<tr>

  <td style="border:1px solid #b0d6e6; text-align:center;">14</td>
  <td style="border:1px solid #b0d6e6;">リハビリ補助具</td>
  <td style="border:1px solid #b0d6e6;">
    <select name="rehab_aids_exist" id="rehab_aids_exist">
      <option value="">選択</option>
      <option value="0">0. なし</option>
      <option value="1">1. あり</option>
      </select>
      <div id="rehab_aids_description_area" style="display:none; margin-top:0.5em;">
        <label for="rehab_aids_description" style="vertical-align:middle; margin-left:1.5em;">内容を記述してください：</label>
        <textarea name="rehab_aids_description" id="rehab_aids_description" rows="2" style="width:85%; font-size:1em;"></textarea>
      </div>
      <script>
      document.addEventListener("DOMContentLoaded", function() {
        var rehabAidsExist = document.getElementById("rehab_aids_exist");
        var rehabAidsDescriptionDiv = document.getElementById("rehab_aids_description_area");
        function checkRehabAidsOption() {
          if (rehabAidsExist.value === "1") {
            rehabAidsDescriptionDiv.style.display = "";
          } else {
            rehabAidsDescriptionDiv.style.display = "none";
            var textarea = rehabAidsDescriptionDiv.querySelector('textarea');
            if (textarea) textarea.value = '';
          }
        }
        rehabAidsExist.addEventListener("change", checkRehabAidsOption);
        checkRehabAidsOption();
      });
      </script>
 
</td>
</tr>
<tr>

      </tbody>
    </table>
  </fieldset>
  <script>
    // 「あり」を選択したときに詳細selectを表示、他は非表示
    function setupDetailSelect(mainId, detailId, otherInputId) {
      var mainSel = document.getElementById(mainId);
      var detailSel = document.getElementById(detailId);
      var otherInput = otherInputId ? document.getElementById(otherInputId) : null;

      if (!mainSel || !detailSel) return;

      // 初期表示
      if (mainSel.value === 'あり') {
        detailSel.style.display = 'inline-block';
      } else {
        detailSel.style.display = 'none';
        detailSel.value = '';
        if (otherInput) {
          otherInput.style.display = 'none';
          otherInput.value = '';
        }
      }

      mainSel.addEventListener('change', function() {
        if (mainSel.value === 'あり') {
          detailSel.style.display = 'inline-block';
        } else {
          detailSel.style.display = 'none';
          detailSel.value = '';
          if (otherInput) {
            otherInput.style.display = 'none';
            otherInput.value = '';
          }
        }
      });

      // その他病名のselectの場合のみ
      if (otherInput && detailSel) {
        // 初期表示
        if (detailSel.value === '99') {
          otherInput.style.display = 'block';
        } else {
          otherInput.style.display = 'none';
          otherInput.value = '';
        }
        detailSel.addEventListener('change', function() {
          if (detailSel.value === '99') {
            otherInput.style.display = 'block';
          } else {
            otherInput.style.display = 'none';
            otherInput.value = '';
          }
        });
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      setupDetailSelect('frailty_exist', 'frailty_detail_select');
      setupDetailSelect('dementia_exist', 'dementia_detail_select');
      setupDetailSelect('cancer_exist', 'cancer_detail_select');
      setupDetailSelect('tracheostomy_exist', 'tracheostomy_detail_select');
      setupDetailSelect('respiratory_exist', 'respiratory_detail_select');
      setupDetailSelect('dialysis_exist', 'dialysis_detail_select');
      setupDetailSelect('stoma_exist', 'stoma_detail_select');
      setupDetailSelect('leg_circulation_exist', 'leg_circulation_detail_select', 'leg_circulation_other');
    });
  </script>
</div>


    <div class="nav-buttons">
      <button type="button" onclick="location.href='form13.html'">← 戻る</button>
      <button type="button" onclick="location.href='form15.html'">次へ →</button>
    </div>
  </form>
</div>

<script>
  // 高額費用の利用：理由欄表示
  function toggleExpensiveCostDetail() {
    const val = document.getElementById('expensive_cost_usage').value;
    const reasonDiv = document.getElementById('expensive_cost_reason');
    if (val === '2a' || val === '2b') {
      reasonDiv.style.display = 'block';
    } else {
      reasonDiv.style.display = 'none';
    }
  }
  
  // 公費医療の利用：理由欄表示
  function togglePublicMedicalReason() {
    const val = document.getElementById('public_medical_usage').value;
    const reasonDiv = document.getElementById('public_medical_reason');
    if (val === '2') {
      reasonDiv.style.display = 'block';
    } else {
      reasonDiv.style.display = 'none';
    }
  }
  
  // 公費医療の詳細：病名入力欄表示
  function toggleMedicalDiseaseInput() {
    const val = document.getElementById('public_medical_detail').value;
    const inputDiv = document.getElementById('medical_disease_input');
    if (val === '5' || val === '3') {
      inputDiv.style.display = 'block';
    } else {
      inputDiv.style.display = 'none';
    }
  }
  
  // 公費制度の利用：理由欄表示
  function togglePublicSystemReason() {
    const val = document.getElementById('public_system_usage').value;
    const reasonDiv = document.getElementById('public_system_reason');
    if (val === '2') {
      reasonDiv.style.display = 'block';
    } else {
      reasonDiv.style.display = 'none';
    }
  }
  
  // 公費制度の詳細：詳細入力欄表示
  function toggleSystemDetailInput() {
    const val = document.getElementById('public_system_detail').value;
    const inputDiv = document.getElementById('system_detail_input');
    if (val === '1' || val === '2') {
      inputDiv.style.display = 'block';
    } else {
      inputDiv.style.display = 'none';
    }
  }

  // フォームの自動保存機能
  const form = document.getElementById('surveyForm');
  form.addEventListener('input', () => {
    const data = Object.fromEntries(new FormData(form));
    localStorage.setItem('surveyData_form2', JSON.stringify(data));
  });

  // 保存されたデータの復元
  window.addEventListener('load', () => {
    const saved = localStorage.getItem('surveyData_form2');
    if (saved) {
      const data = JSON.parse(saved);
      Object.keys(data).forEach(key => {
        const el = form.elements[key];
        if (el) {
          el.value = data[key];
        }
      });
    }
    
    // 全てのselect要素を「選択」にリセット
    const allSelects = document.querySelectorAll('select');
    allSelects.forEach(select => {
      select.value = '';
    });
  });
</script>

  <!-- プログレスバー -->
  <div class="progress-container">
    <div class="progress-wrapper">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-info">
        <span class="progress-page" id="currentPage">15</span>
        <span class="progress-total">/ 20</span>
      </div>
    </div>
  </div>

  <script>
    // プログレスバーの更新
    function updateProgress() {
      const progressPercentage = (15 / 20) * 100;
      const progressFill = document.getElementById('progressFill');
      const currentPageElement = document.getElementById('currentPage');
      
      progressFill.style.width = progressPercentage + '%';
      currentPageElement.textContent = '15';
      progressFill.style.background = '#003366';
    }
    
    // 初期プログレス更新
    document.addEventListener('DOMContentLoaded', function() {
      updateProgress();
      
      // フォームの自動保存機能
      const form = document.getElementById('surveyForm');
      const formNumber = 14;
      
      if (form) {
        function collectFormData() {
          const formData = new FormData(form);
          const data = {};
          for (let [key, value] of formData.entries()) {
            if (data[key]) {
              if (Array.isArray(data[key])) {
                data[key].push(value);
              } else {
                data[key] = [data[key], value];
              }
            } else {
              data[key] = value;
            }
          }
          const canvases = form.querySelectorAll('canvas');
          canvases.forEach((canvas, index) => {
            try {
              const canvasId = canvas.id || `canvas_${index}`;
              data[canvasId + '_image'] = canvas.toDataURL('image/png');
            } catch (e) {
              console.error('Canvas保存エラー:', e);
            }
          });
          const allInputs = form.querySelectorAll('input, select, textarea');
          allInputs.forEach(input => {
            if (!input.name) return;
            const isProcessed = data.hasOwnProperty(input.name);
            if (input.type === 'checkbox') {
              if (input.checked) {
                if (!data[input.name]) data[input.name] = [];
                if (Array.isArray(data[input.name])) {
                  if (!data[input.name].includes(input.value)) data[input.name].push(input.value);
                } else {
                  data[input.name] = [data[input.name], input.value];
                }
              }
            } else if (input.type === 'radio') {
              if (input.checked && !isProcessed) data[input.name] = input.value;
            } else {
              if (!isProcessed && input.value) data[input.name] = input.value;
            }
          });
          return data;
        }
        
        form.addEventListener('input', function() {
          const data = collectFormData();
          localStorage.setItem(getFormStorageKey(formNumber), JSON.stringify(data));
          console.log(`Form ${formNumber} データを自動保存しました`);
        });
        
        form.addEventListener('change', function() {
          const data = collectFormData();
          localStorage.setItem(getFormStorageKey(formNumber), JSON.stringify(data));
          console.log(`Form ${formNumber} データを自動保存しました`);
        });
        
        const savedData = localStorage.getItem(getFormStorageKey(formNumber));
        if (savedData) {
          const data = JSON.parse(savedData);
          Object.keys(data).forEach(key => {
            const elements = form.elements[key];
            if (elements) {
              if (elements.length > 1) {
                Array.from(elements).forEach(el => {
                  if (el.type === 'checkbox' || el.type === 'radio') {
                    if (Array.isArray(data[key])) {
                      el.checked = data[key].includes(el.value);
                    } else {
                      el.checked = el.value === data[key];
                    }
                  }
                });
              } else if (elements.length === 1) {
                const el = elements[0];
                if (el.type === 'checkbox' || el.type === 'radio') {
                  if (Array.isArray(data[key])) {
                    el.checked = data[key].includes(el.value);
                  } else {
                    el.checked = el.value === data[key];
                  }
                } else {
                  el.value = data[key] || '';
                }
              } else {
                if (elements.type === 'checkbox' || elements.type === 'radio') {
                  if (Array.isArray(data[key])) {
                    elements.checked = data[key].includes(elements.value);
                  } else {
                    elements.checked = elements.value === data[key];
                  }
                } else {
                  elements.value = data[key] || '';
                }
              }
            }
          });
          console.log(`Form ${formNumber} の保存データを復元しました`);
        }
      }
    });
  </script>

</body>
</html>



