
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
  <title>APOS-HC å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  - ãƒ•ã‚©ãƒ¼ãƒ 1</title>
  <link rel="stylesheet" href="main.css">
  <style>
    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºã®ä¿®æ­£ */
    .section { 
      display: block !important; 
    }
    
    /* iPadç”¨ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
    @media screen and (min-width: 768px) {
      body {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        font-size: 16px;
        line-height: 1.5;
      }
      
      .container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        padding: 25px;
        margin: 15px 0;
      }
      
      h1 {
        font-size: 1.8em;
        color: #2c3e50;
        text-align: center;
        margin-bottom: 25px;
        border-bottom: 2px solid #3498db;
        padding-bottom: 15px;
      }
      
      h2 {
        font-size: 1.4em;
        color: #34495e;
        margin: 25px 0 15px 0;
        padding: 10px 0;
        border-left: 4px solid #3498db;
        padding-left: 15px;
        background: linear-gradient(90deg, #f8f9fa 0%, transparent 100%);
      }
      
      fieldset {
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background: #fafbfc;
        transition: all 0.3s ease;
      }
      
      fieldset:hover {
        border-color: #3498db;
        box-shadow: 0 2px 10px rgba(52, 152, 219, 0.1);
      }
      
      legend {
        font-size: 1.1em;
        font-weight: bold;
        color: #2c3e50;
        padding: 0 10px;
        background: #fff;
        border-radius: 6px;
        border: 2px solid #3498db;
      }
      
      label {
        display: block;
        margin: 10px 0 5px 0;
        font-weight: 600;
        color: #34495e;
        font-size: 1em;
      }
      
      input[type="text"], input[type="tel"], input[type="email"], 
      input[type="number"], input[type="date"], select, textarea {
        width: 100%;
        padding: 10px 12px;
        font-size: 1em;
        border: 2px solid #e0e6ed;
        border-radius: 6px;
        background: #fff;
        transition: all 0.3s ease;
        box-sizing: border-box;
        margin-top: 5px;
      }
      
      input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        transform: translateY(-2px);
      }
      
      textarea {
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
      }
      
      .family-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
      }
      
      .family-table th {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 20px 15px;
        font-size: 1.2em;
        font-weight: bold;
        text-align: center;
      }
      
      .family-table td {
        padding: 18px 15px;
        border-bottom: 1px solid #e8f4f8;
        text-align: center;
        vertical-align: middle;
      }
      
      .family-table td:first-child {
        background: #f8f9fa;
        font-weight: 600;
        color: #2c3e50;
        font-size: 1.1em;
      }
      
      .family-table input {
        width: 100%;
        padding: 12px 15px;
        font-size: 1.05em;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        background: #fff;
        transition: all 0.3s ease;
        margin: 0;
      }
      
      .family-table input:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }
      
      .family-table tr:hover {
        background: #f8f9fa;
      }
      
      .note {
        font-size: 1em;
        color: #7f8c8d;
        margin-top: 15px;
        padding: 15px;
        background: #ecf0f1;
        border-radius: 8px;
        border-left: 4px solid #95a5a6;
      }
      
      .nav-buttons {
        margin-top: 25px;
        display: flex;
        justify-content: space-between;
        gap: 15px;
      }
      
      .nav-buttons button {
        padding: 12px 25px;
        font-size: 1em;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
      }
      
      .nav-buttons button:first-child {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        color: white;
      }
      
      .nav-buttons button:last-child {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }
      
      .nav-buttons button:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      }
      
      .nav-buttons button:active {
        transform: translateY(-1px);
      }
      
      .family-block {
        margin-bottom: 20px;
        padding: 15px;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        background: #f8f9fa;
      }
      
      canvas {
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        background: #fff;
      }
      
      .toggle {
        appearance: none;
        width: 60px;
        height: 30px;
        background: #ccc;
        border-radius: 15px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .toggle:checked {
        background: #4CAF50;
      }
      
      .toggle:before {
        content: "";
        position: absolute;
        top: 3px;
        left: 3px;
        width: 24px;
        height: 24px;
        background: white;
        border-radius: 50%;
        transition: 0.3s ease;
      }
      
      .toggle:checked:before {
        transform: translateX(30px);
      }
      
      /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .progress-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #fff;
        border-top: 1px solid #e0e0e0;
        padding: 20px;
        z-index: 1000;
      }
      
      .progress-wrapper {
        max-width: 800px;
        margin: 0 auto;
      }
      
      .progress-bar {
        width: 100%;
        height: 6px;
        background: #f0f0f0;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 15px;
      }
      
      .progress-fill {
        height: 100%;
        background: #003366;
        border-radius: 3px;
        transition: width 0.5s ease;
        width: 5%;
      }
      
      .progress-info {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.1em;
        color: #333;
        font-weight: 500;
      }
      
      .progress-page {
        color: #003366;
        font-weight: 600;
      }
      
      .progress-total {
        color: #999;
      }
      
      /* ãƒ•ã‚©ãƒ¼ãƒ ã®ä¸‹éƒ¨ã«ä½™ç™½ã‚’è¿½åŠ ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®åˆ†ï¼‰ */
      body {
        padding-bottom: 100px;
      }
    }
    /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ã®è¿½åŠ èª¿æ•´ */
    @media screen and (max-width: 1024px) and (min-width: 768px) {
      .family-table input {
        font-size: 1em;
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>APOS-HC èª¿æŸ»ç¥¨</h1>
  <form id="surveyForm">

<table style="width:100%; border-collapse:collapse; margin-bottom:1.5em; font-size:1em;">
  <tr>
    <td style="border:1px solid #b0d6e6; width:10%; background:#f5fafd;">
      åˆ©ç”¨è€…æ°å<br>
      <span style="font-size:0.9em;">User name</span><br>
      <span style="font-size:0.9em; color:#888;">ãµã‚ŠãŒãª</span>
    </td>
    <td style="border:1px solid #b0d6e6; width:30%;">
      <div style="margin-bottom:4px;">
        <input type="text" name="last_name" placeholder="å§“" style="width:45%;"> 
        <input type="text" name="first_name" placeholder="å" style="width:45%;">
      </div>
      <div>
        <input type="text" name="last_name_kana" placeholder="ã›ã„ï¼ˆãµã‚ŠãŒãªï¼‰" style="width:45%;"> 
        <input type="text" name="first_name_kana" placeholder="ã‚ã„ï¼ˆãµã‚ŠãŒãªï¼‰" style="width:45%;">
      </div>
    </td>
    <td style="border:1px solid #b0d6e6; width:10%; background:#f5fafd;">
      ç”Ÿå¹´æœˆæ—¥<br>å¹´é½¢<br>
    </td>
    <td style="border:1px solid #b0d6e6; width:25%;">
      <input type="text" name="birth_year" placeholder="å¹´" style="width:70%;"> <br>
      <input type="text" name="birth_month" placeholder="æœˆ" style="width:40%;"> /
      <input type="text" name="birth_day" placeholder="æ—¥" style="width:40%;"><br> 
      <input type="text" name="age" placeholder="å¹´é½¢" style="width:40%;"> 
      <span style="margin-left:8px;">æ­³</span>

    </td>
    <td style="border:1px solid #b0d6e6; width:5%; background:#f5fafd;">æ€§åˆ¥<br>
    <td style="border:1px solid #b0d6e6; width:15%;">
      <select name="sex" style="width:90%;">
        <option value="">é¸æŠ</option>
        <option value="ç”·">ç”·æ€§</option>
        <option value="å¥³">å¥³æ€§</option>
        <option value="æŒ‡å®šãªã—">æŒ‡å®šãªã—</option>
        <option value="NA">NA</option>
      </select>
    </td>
  </tr>
  <tr>
    <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">ä¾é ¼è€…<br></td>
    <td colspan="5" style="border:1px solid #b0d6e6;">
      <select name="request_route" style="width:90%;">
        <option value="">é¸æŠ</option>
        <option value="CM">1.CM</option>
        <option value="MSW">2.MSW</option>
        <option value="ç—…é™¢åŒ»å¸«">3.ç—…é™¢åŒ»å¸«</option>
        <option value="ç—…é™¢NS">4.ç—…é™¢NS</option>
        <option value="é–‹æ¥­åŒ»å¸«">5.é–‹æ¥­åŒ»å¸«</option>
        <option value="ç¦ç¥‰è·å“¡">6.ç¦ç¥‰è·å“¡</option>
        <option value="ä¿å¥æ‰€ãƒ»ä¿å¥ã‚»ãƒ³ã‚¿ãƒ¼è·å“¡">7.ä¿å¥æ‰€ãƒ»ä¿å¥ã‚»ãƒ³ã‚¿ãƒ¼è·å“¡</option>
        <option value="å®¶æ—">8.å®¶æ—</option>
        <option value="ãã®ä»–">9.ãã®ä»–</option>
      </select>
    </td>
  </tr>
  <tr>
    <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">ä¾é ¼æ©Ÿé–¢å<br></td>
    <td colspan="5" style="border:1px solid #b0d6e6;">
      <input type="text" name="request_organization" placeholder="ä¾‹ï¼šã€‡ã€‡ç—…é™¢ã€ã€‡ã€‡åŒ…æ‹¬æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼ãªã©" style="width:98%;">
    </td>
  </tr>
  <tr>
    <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">ä¾é ¼è€…å<br>(æ‹…å½“è€…)<br></td>
    <td colspan="5" style="border:1px solid #b0d6e6;">
      <input type="text" name="requestor_name" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" style="width:98%;">
    </td>
  </tr>
  <tr>
    <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">ä¾é ¼è€…<br>é›»è©±ç•ªå·<br></td>
    <td colspan="5" style="border:1px solid #b0d6e6;">
      <input type="text" name="requestor_tel" placeholder="ä¾‹ï¼š03-1234-5678" style="width:98%;">
    </td>
  </tr>
  <tr>
    <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">ä¾é ¼è€…Fax<br></td>
    <td colspan="5" style="border:1px solid #b0d6e6;">
      <input type="text" name="requestor_fax" placeholder="ä¾‹ï¼š03-1234-5679" style="width:98%;">
    </td>
  </tr>
  <tr>
    <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">ä¾é ¼è€…mail<br></td>
    <td colspan="5" style="border:1px solid #b0d6e6;">
      <input type="email" name="requestor_email" placeholder="ä¾‹ï¼šexample@mail.com" style="width:98%;">
    </td>
  </tr>
<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    å—ä»˜å¹´æœˆæ—¥<br>å¯¾å¿œè€…<br>
    <span style="font-size:0.9em;">ç›¸è«‡/ä¾é ¼ç†ç”±</span>
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: start;">
      <div style="display: flex; flex-direction: column; gap: 7px;">
        <div>

          <label style="font-weight: bold; min-width: 3em; display: inline-block;">å—ä»˜æ—¥ï¼š</label><br>
        <input type="number" name="reception_year" min="1900" max="2100" style="width:4em;" placeholder="å¹´"> å¹´
        <input type="number" name="reception_month" min="1" max="12" style="width:3em;" placeholder="æœˆ"> æœˆ
        <input type="number" name="reception_day" min="1" max="31" style="width:3em;" placeholder="æ—¥"> æ—¥
        </div>
        <div>
          <label style="font-weight: bold; min-width: 3em; display: inline-block;">å—ä»˜æ™‚åˆ»ï¼š</label><br>
        <input type="number" name="reception_hour" min="0" max="23" style="width:3em;" placeholder="æ™‚"> æ™‚
        <input type="number" name="reception_minute" min="0" max="59" style="width:3em;" placeholder="åˆ†"> åˆ†
        </div>
      </div>
      <div style="display: flex; flex-direction: column; gap: 7px;">
        <div>
          <label style="font-weight: bold;">å—ä»˜æ–¹æ³•ï¼š</label>
          <select name="reception_method" style="margin-right:0.5em;">
        <option value="">é¸æŠ</option>
        <option value="æ›¸é¢">æ›¸é¢</option>
        <option value="Fax">Fax</option>
        <option value="é¢ä¼š">é¢ä¼š</option>
        <option value="mail">mail</option>
        <option value="é›»è©±">é›»è©±</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
        </div>
        <div>
          <label style="font-weight: bold;">å¯¾å¿œè€…ï¼š</label>
      <input type="text" name="reception_staff" style="width:10em;" placeholder="å¯¾å¿œè€…å">
        </div>
      </div>
    </div>
    <div style="margin-top:12px;">
      <label style="font-weight:bold;">ä¾é ¼ç†ç”±ï¼š</label>
      <textarea name="request_reason" rows="3" style="width:100%; margin-top:5px;" placeholder="ä¾é ¼ãƒ»ç›¸è«‡ã®ç†ç”±ã‚„å†…å®¹ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
    </div>
  </td>
</tr>
<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆç†ç”±/å¹´æœˆæ—¥<br>
    <span style="font-size:0.9em;">å¹´æœˆæ—¥</span>
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <table style="width:100%; border-collapse:collapse;">
      <tr>
        <td style="border:1px solid #000; padding:6px; text-align:center; min-width:60px; white-space:nowrap;">â‘ åˆå›</td>
        <td style="border:1px solid #000; padding:8px; text-align:center;">
          <input type="number" name="assessment_first_year" min="1900" max="2100" style="width8em; text-align:center;" placeholder="å¹´">
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em; justify-content: center;">
          <input type="number" name="assessment_first_month" min="1" max="12" style="width:3em;" placeholder="æœˆ">
          <input type="number" name="assessment_first_day" min="1" max="31" style="width:3em;" placeholder="æ—¥">
        </div>
        </td>
        <td style="border:1px solid #000; padding:8px; text-align:center; min-width:80px; white-space:nowrap;">â‘¡å®šæœŸç¶™ç¶š<br>è©•ä¾¡</td>
        <td style="border:1px solid #000; padding:8px; text-align:center;">
          <div style="display: flex; flex-direction: column; align-items: center;">
            <input type="number" name="assessment_first_year" min="1900" max="2100" style="width8em; text-align:center;" placeholder="å¹´">
          </div>
          <div style="display: flex; align-items: center; gap: 0.5em; justify-content: center;">
            <input type="number" name="assessment_first_month" min="1" max="12" style="width:3em;" placeholder="æœˆ">
            <input type="number" name="assessment_first_day" min="1" max="31" style="width:3em;" placeholder="æ—¥">
          </div>
        <td style="border:1px solid #000; padding:8px; text-align:center; min-width:70px; white-space:nowrap;">â‘¢çŠ¶æ…‹æ‚ªåŒ–</td>
        <td style="border:1px solid #000; padding:8px; text-align:center;">
          <input type="number" name="assessment_first_year" min="1900" max="2100" style="width8em; text-align:center;" placeholder="å¹´">
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em; justify-content: center;">
          <input type="number" name="assessment_first_month" min="1" max="12" style="width:3em;" placeholder="æœˆ">
          <input type="number" name="assessment_first_day" min="1" max="31" style="width:3em;" placeholder="æ—¥">
        </div>
      </tr>
      <tr>
        <td style="border:1px solid #000; padding:8px; text-align:center; min-width:60px; white-space:nowrap;">â‘£é€€é™¢</td>
        <td style="border:1px solid #000; padding:8px; text-align:center;">
          <input type="number" name="assessment_first_year" min="1900" max="2100" style="width8em; text-align:center;" placeholder="å¹´">
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em; justify-content: center;">
          <input type="number" name="assessment_first_month" min="1" max="12" style="width:3em;" placeholder="æœˆ">
          <input type="number" name="assessment_first_day" min="1" max="31" style="width:3em;" placeholder="æ—¥">
        </div>
        <td style="border:1px solid #000; padding:8px; text-align:center; min-width:60px; white-space:nowrap;">â‘¤å…¥é™¢</td>
        <td style="border:1px solid #000; padding:8px; text-align:center;">
          <input type="number" name="assessment_first_year" min="1900" max="2100" style="width8em; text-align:center;" placeholder="å¹´">
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em; justify-content: center;">
          <input type="number" name="assessment_first_month" min="1" max="12" style="width:3em;" placeholder="æœˆ">
          <input type="number" name="assessment_first_day" min="1" max="31" style="width:3em;" placeholder="æ—¥">
        </div>
        <td style="border:1px solid #000; padding:8px;"></td>
        <td style="border:1px solid #000; padding:8px;"></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    å‚åŠ è€…<br>
    
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <div style="display: flex; flex-wrap: wrap; gap: 1em;">
      <label><input type="checkbox" name="participant" value="1"> 1.æœ¬äºº</label>
      <label><input type="checkbox" name="participant" value="2"> 2.æ¯å­</label>
      <label><input type="checkbox" name="participant" value="3"> 3.å¨˜</label>
      <label><input type="checkbox" name="participant" value="4"> 4.å¦»/å¤«ãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</label>
      <label><input type="checkbox" name="participant" value="5"> 5.çˆ¶æ¯ï¼ˆç¾©ç†å«ã‚€ï¼‰</label>
      <label><input type="checkbox" name="participant" value="6"> 6.CM</label>
      <label><input type="checkbox" name="participant" value="7"> 7.MSW</label>
      <label><input type="checkbox" name="participant" value="8"> 8.åŒ»å¸«</label>
      <label><input type="checkbox" name="participant" value="8"> 9.åŒ»ç™‚ãƒ»æ–½è¨­Nï½“</label>
      <label><input type="checkbox" name="participant" value="10"> 10.ãã®ä»–</label>
    </div>
    <div style="font-size:0.9em; color:#666; margin-top:0.3em;">â€»è¤‡æ•°é¸æŠã§ãã¾ã™</div>
  </td>
</tr>
<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    é¢è«‡å ´æ‰€<br>
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <select name="interview_location" style="width:98%;">
      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
      <option value="1">1.è‡ªå®…</option>
      <option value="2">2.å…¥é™¢æ–½è¨­å†…</option>
      <option value="3">3.ãã®ä»–</option>
    </select>
    <input type="text" id="interview_location_other" name="interview_location_other" style="width:98%; margin-top:0.5em;" placeholder="ãã®ä»–ã®å ´åˆã¯ã”è¨˜å…¥ãã ã•ã„">
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const select = document.querySelector('select[name="interview_location"]');
        const otherInput = document.getElementById('interview_location_other');
        if (select && otherInput) {
          function toggleOtherInput() {
            if (select.value === "3") {
              otherInput.style.display = "block";
            } else {
              otherInput.style.display = "none";
              otherInput.value = "";
            }
          }
          select.addEventListener('change', toggleOtherInput);
          // åˆæœŸè¡¨ç¤º
          toggleOtherInput();
        }
      });
    </script>
  </td>     
</tr>
<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    24æ™‚é–“å¯¾å¿œ<br>
    </span>
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <div style="display: flex; align-items: center; gap: 1.5em; flex-wrap: wrap;">
      <div>
        <label for="cm_24h">CMï¼š</label>
        <select name="cm_24h" id="cm_24h">   
          <option value="">é¸æŠ</option>
          <option value="0">0.è¦æœ›ãªã—</option>
          <option value="1">1.è¦æœ›ã‚ã‚Š</option>
        </select>
      </div>
      <div>
        <label for="kaigo_24h">ä»‹è­·ï¼š</label>
        <select name="kaigo_24h" id="kaigo_24h">
          <option value="">é¸æŠ</option>
          <option value="0">0.è¦æœ›ãªã—</option>
          <option value="1">1.è¦æœ›ã‚ã‚Š</option>
        </select>
      </div>
      <div>
        <label for="kangoshi_24h">çœ‹è­·ï¼š</label>
        <select name="kangoshi_24h" id="kangoshi_24h">
          <option value="">é¸æŠ</option>
          <option value="0">0.è¦æœ›ãªã—</option>
          <option value="1">1.è¦æœ›ã‚ã‚Š</option>
        </select>
      </div>
    </div>
  </td>
</tr>

<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    çµ‚äº†å¹´æœˆæ—¥<br>
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <div style="display: flex; align-items: center; gap: 1em;">
      <label>
        <input type="number" name="end_year" min="1900" max="2100" style="width:4em;" placeholder="å¹´">
        
      </label>
      <label>
        <input type="number" name="end_month" min="1" max="12" style="width:3em;" placeholder="æœˆ">
        
      </label>
      <label>
        <input type="number" name="end_day" min="1" max="31" style="width:3em;" placeholder="æ—¥">
        
      </label>
      <label>
        ã‚µãƒãƒªãƒ¼è¨˜éŒ²è€…ï¼š
        <input type="text" name="summary_recorder" style="width:15em; margin-left:0.5em;" placeholder="è¨˜éŒ²è€…åã‚’å…¥åŠ›">
      </label>
    </div>
  </td>
</tr>

<tr>
  <td style="border:1px solid #b0d6e6; width:15%; background:#f5fafd;">
    çµ‚äº†æ™‚<br>ã‚µãƒãƒªãƒ¼<br>
  </td>
  <td colspan="5" style="border:1px solid #b0d6e6;">
    <textarea name="exit_summary" id="exit_summary" rows="4" style="width:98%;" placeholder="çµ‚äº†æ™‚ã®ã‚µãƒãƒªãƒ¼ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
  </td>
</tr>


<tr>
  <td colspan="5" style="text-align:right; border:none;">
    <div class="nav-buttons">
      <button type="button" onclick="window.location.href='form1.html'">æ¬¡ã¸ â†’</button>
    </div>
  </td>
</tr>

 
 
  

  </script>

  <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
  <div class="progress-container">
    <div class="progress-wrapper">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-info">
        <span class="progress-page" id="currentPage">1</span>
        <span class="progress-total">/ 20</span>
      </div>
    </div>
  </div>

  <script>
    // ãƒšãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
    const totalPages = 20;
    let currentPage = 1;
    
    function updateProgress() {
      const progressPercentage = (currentPage / totalPages) * 100;
      const progressFill = document.getElementById('progressFill');
      const currentPageElement = document.getElementById('currentPage');
      
      progressFill.style.width = progressPercentage + '%';
      currentPageElement.textContent = currentPage;
      
      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è‰²ã‚’æ¿ƒã„é’ã«çµ±ä¸€
      progressFill.style.background = '#003366';
    }
    
    // ãƒšãƒ¼ã‚¸é€²è¡Œã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«å‘¼ã³å‡ºã—ï¼‰
    function goToNextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        updateProgress();
      }
    }
    
    function goToPreviousPage() {
      if (currentPage > 1) {
        currentPage--;
        updateProgress();
      }
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å®Œäº†åº¦ã®è¡¨ç¤ºï¼ˆãƒšãƒ¼ã‚¸é€²è¡Œã¯ã—ãªã„ï¼‰
    function updateProgressBasedOnInput() {
      const form = document.getElementById('surveyForm');
      const inputs = form.querySelectorAll('input, select, textarea');
      let filledCount = 0;
      
      inputs.forEach(input => {
        if (input.type === 'checkbox' || input.type === 'radio') {
          if (input.checked) filledCount++;
        } else if (input.value.trim() !== '') {
          filledCount++;
        }
      });
      
      const completionRate = filledCount / inputs.length;
      
      // å…¥åŠ›å®Œäº†åº¦ã‚’è¡¨ç¤ºã™ã‚‹ãŒã€ãƒšãƒ¼ã‚¸æ•°ã¯å¤‰æ›´ã—ãªã„
      console.log(`å…¥åŠ›å®Œäº†åº¦: ${Math.round(completionRate * 100)}% (${filledCount}/${inputs.length}é …ç›®)`);
      
      // ãƒšãƒ¼ã‚¸æ•°ã¯æ‰‹å‹•ã§å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿æ›´æ–°
      // currentPageã¯è‡ªå‹•ã§ã¯å¤‰æ›´ã—ãªã„
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('surveyForm');
      const inputs = form.querySelectorAll('input, select, textarea');
      
      // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯å‰Šé™¤ï¼ˆãƒšãƒ¼ã‚¸æ•°ãŒè‡ªå‹•ã§å¤‰ã‚ã‚‰ãªã„ã‚ˆã†ã«ï¼‰
      // inputs.forEach(input => {
      //   input.addEventListener('input', updateProgressBasedOnInput);
      //   input.addEventListener('change', updateProgressBasedOnInput);
      // });
      
      // åˆæœŸãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
      updateProgress();
      
      // ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã«ãƒšãƒ¼ã‚¸é€²è¡Œæ©Ÿèƒ½ã‚’è¿½åŠ 
      const nextButton = document.querySelector('button[onclick*="form1.html"]');
      if (nextButton) {
        nextButton.addEventListener('click', function(e) {
          e.preventDefault();
          goToNextPage();
          // å®Ÿéš›ã®ãƒšãƒ¼ã‚¸é·ç§»ã¯ã“ã“ã§å®Ÿè¡Œ
          setTimeout(() => {
            window.location.href = 'form1.html';
          }, 300);
        });
      }
    });
    
    // APIé€ä¿¡æ©Ÿèƒ½
    async function submitForm() {
      try {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å–å¾—ï¼‰
        const userId = localStorage.getItem('user_id') || 'demo_user_001';
        
        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        const result = await window.aposAPI.submitForm(userId, 'surveyForm');
        console.log('Form submitted successfully:', result);
        
        // æˆåŠŸæ™‚ã®å‡¦ç†
        alert('ãƒ•ã‚©ãƒ¼ãƒ ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã—ãŸã€‚');
        
      } catch (error) {
        console.error('Form submission error:', error);
        alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
      }
    }
    
    // ç›´æ¥FastAPIã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã™ã‚‹æ©Ÿèƒ½
    async function submitFormToServer() {
      try {
        const form = document.getElementById('surveyForm');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // æ•´æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç©ºæ–‡å­—åˆ—ã‚’nullã«å¤‰æ›
        const integerFields = [
          "birth_year", "birth_month", "birth_day", "age",
          "reception_year", "reception_month", "reception_day", "reception_hour", "reception_minute",
          "assessment_first_year", "assessment_first_month", "assessment_first_day",
          "assessment_regular_year", "assessment_regular_month", "assessment_regular_day",
          "assessment_deterioration_year", "assessment_deterioration_month", "assessment_deterioration_day",
          "assessment_discharge_year", "assessment_discharge_month", "assessment_discharge_day",
          "assessment_admission_year", "assessment_admission_month", "assessment_admission_day",
          "end_year", "end_month", "end_day"
        ];
        
        for (const field of integerFields) {
          if (data[field] === "" || data[field] === undefined) {
            data[field] = null;
          } else if (data[field] !== null) {
            // æ•°å€¤ã«å¤‰æ›ã§ãã‚‹å ´åˆã¯å¤‰æ›ã‚’è©¦ã¿ã‚‹
            const numValue = parseInt(data[field], 10);
            if (!isNaN(numValue)) {
              data[field] = numValue;
            } else {
              data[field] = null;
            }
          }
        }
        
        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å‡¦ç†ï¼ˆparticipantãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
        const participants = [];
        const participantCheckboxes = document.querySelectorAll('input[name="participant"]:checked');
        participantCheckboxes.forEach(checkbox => {
          participants.push(checkbox.value);
        });
        data.participant = participants;
        
        console.log('é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', data);
        
        // ç’°å¢ƒã«å¿œã˜ã¦API URLã‚’æ±ºå®š
        const baseURL = window.location.hostname.includes("localhost") 
          ? "http://localhost:8000" 
          : "https://homecare-form.com";
        
        // FastAPIã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
        const response = await fetch(`${baseURL}/api/form1`, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json' 
          },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          const result = await response.json();
          alert('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã—ãŸï¼ID: ' + result.id);
          console.log('é€ä¿¡æˆåŠŸ:', result);
        } else {
          const errorData = await response.text();
          alert('é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + response.status + ' - ' + errorData);
          console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', response.status, errorData);
        }
        
      } catch (error) {
        console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
        alert('é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
      }
    }
    
  
    
    // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
    function setAuthToken() {
      // å®Ÿéš›ã®å®Ÿè£…ã§ã¯èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å–å¾—
      const demoToken = 'demo_jwt_token_' + Date.now();
      window.aposAPI.setToken(demoToken);
      console.log('Auth token set:', demoToken);
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š
    document.addEventListener('DOMContentLoaded', function() {
      setAuthToken();
      
      // ãƒ•ã‚©ãƒ¼ãƒ ã®è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
      const form = document.getElementById('surveyForm');
      const formNumber = 0; // form0
      // è¤‡æ•°æ‚£è€…å¯¾å¿œ: pidã®å–å¾—ï¼ˆæœªè¨­å®šæ™‚ã¯ç”Ÿæˆã—ã¦ä¿æŒï¼‰
      function ensurePid() {
        let pid = localStorage.getItem('apos_pid');
        if (!pid) {
          pid = 'pid_' + Date.now() + '_' + Math.random().toString(36).slice(2,8);
          localStorage.setItem('apos_pid', pid);
        }
        return pid;
      }
      function lsKey(n){ return `surveyData_${ensurePid()}_form${n}`; }
      
      // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹é–¢æ•°ï¼ˆæ”¹å–„ç‰ˆï¼šCanvasç”»åƒãƒ»éè¡¨ç¤ºé …ç›®å¯¾å¿œï¼‰
      function collectFormData() {
        const formData = new FormData(form);
        const data = {};
        
        // é€šå¸¸ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        for (let [key, value] of formData.entries()) {
          if (data[key]) {
            // åŒã˜åå‰ã®è¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãªã©ï¼‰
            if (Array.isArray(data[key])) {
              data[key].push(value);
            } else {
              data[key] = [data[key], value];
            }
          } else {
            data[key] = value;
          }
        }
        
        // Canvasç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        const canvases = form.querySelectorAll('canvas');
        canvases.forEach((canvas, index) => {
          try {
            const canvasId = canvas.id || `canvas_${index}`;
            data[canvasId + '_image'] = canvas.toDataURL('image/png');
            console.log(`Canvasç”»åƒã‚’ä¿å­˜ã—ã¾ã—ãŸ: ${canvasId}`);
          } catch (e) {
            console.error('Canvasä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
          }
        });
        
        // éè¡¨ç¤ºé …ç›®ã‚‚å«ã‚ã¦å…¨å…¥åŠ›è¦ç´ ã‚’ç¢ºèª
        const allInputs = form.querySelectorAll('input, select, textarea');
        allInputs.forEach(input => {
          if (!input.name) return;
          
          // ã™ã§ã«FormDataã§å‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          const isProcessed = data.hasOwnProperty(input.name);
          
          if (input.type === 'checkbox') {
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯é…åˆ—ã¨ã—ã¦ä¿å­˜
            if (input.checked) {
              if (!data[input.name]) {
                data[input.name] = [];
              }
              if (Array.isArray(data[input.name])) {
                if (!data[input.name].includes(input.value)) {
                  data[input.name].push(input.value);
                }
              } else {
                data[input.name] = [data[input.name], input.value];
              }
            }
          } else if (input.type === 'radio') {
            // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã¯ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã¿
            if (input.checked && !isProcessed) {
              data[input.name] = input.value;
            }
          } else {
            // ãã®ä»–ã®å…¥åŠ›è¦ç´ ï¼ˆéè¡¨ç¤ºã§ã‚‚å€¤ãŒã‚ã‚Œã°ä¿å­˜ï¼‰
            if (!isProcessed && input.value) {
              data[input.name] = input.value;
            }
          }
        });
        
        return data;
      }
      
      // å…¥åŠ›æ™‚ã«è‡ªå‹•ä¿å­˜
      form.addEventListener('input', function() {
        const data = collectFormData();
        localStorage.setItem(lsKey(formNumber), JSON.stringify(data));
        console.log(`Form ${formNumber} ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ä¿å­˜ã—ã¾ã—ãŸ`);
      });
      
      form.addEventListener('change', function() {
        const data = collectFormData();
        localStorage.setItem(lsKey(formNumber), JSON.stringify(data));
        console.log(`Form ${formNumber} ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ä¿å­˜ã—ã¾ã—ãŸ`);
      });
      
      // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ
      const savedData = localStorage.getItem(lsKey(formNumber));
      if (savedData) {
        const data = JSON.parse(savedData);
        Object.keys(data).forEach(key => {
          const elements = form.elements[key];
          if (elements) {
            if (elements.length > 1) {
              // è¤‡æ•°è¦ç´ ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
              Array.from(elements).forEach(el => {
                if (el.type === 'checkbox' || el.type === 'radio') {
                  if (Array.isArray(data[key])) {
                    el.checked = data[key].includes(el.value);
                  } else {
                    el.checked = el.value === data[key];
                  }
                }
              });
            } else if (elements.length === 1) {
              // å˜ä¸€è¦ç´ ï¼ˆè¤‡æ•°ã®åŒåè¦ç´ ã®1ã¤ï¼‰
              const el = elements[0];
              if (el.type === 'checkbox' || el.type === 'radio') {
                if (Array.isArray(data[key])) {
                  el.checked = data[key].includes(el.value);
                } else {
                  el.checked = el.value === data[key];
                }
              } else {
                el.value = data[key] || '';
              }
            } else {
              // å˜ä¸€è¦ç´ 
              if (elements.type === 'checkbox' || elements.type === 'radio') {
                if (Array.isArray(data[key])) {
                  elements.checked = data[key].includes(elements.value);
                } else {
                  elements.checked = elements.value === data[key];
                }
              } else {
                elements.value = data[key] || '';
              }
            }
          }
        });
        console.log(`Form ${formNumber} ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ`);
      }
    });
  </script>
  
  <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
  <div style="text-align: center; margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <button type="button" onclick="submitFormToServer()" style="
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      margin: 0 10px;
    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(40, 167, 69, 0.4)'" 
       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
      ğŸ“¤ ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
    </button>
    

    
    <button onclick="window.location.href='form1.html'" style="
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      margin: 0 10px;
    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0, 123, 255, 0.4)'" 
       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
      â¡ï¸ æ¬¡ã¸
    </button>
  </div>
 
  </div>
  
  </body>
  </html>
  